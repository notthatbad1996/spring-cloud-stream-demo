# spring-cloud-stream-demo

## 订单服务延时队列关单
#### 1、下单时将订单加入延时队列，n时间后没被消费则转入死信队列；
#### 2、将死信队列中的订单关闭，同时给库存服务发送解锁库存消息

## 库存服务延时队列解锁库存
#### 1、为了避免队列网络延迟库存解锁失败，订单服务关闭订单时直接将订单发到死信队列；
#### 2、订单服务下订单时发送库存锁定消息，m（m>n）分钟后转入死信队列；
#### 3、检测死信队列中的订单状态如果符合解锁逻辑则解锁库存；
#### 4、延迟队列中的订单解锁时需要检测库存工单状态是否为未解锁后才解锁防止重复解锁。
